import pygame
from sys import exit

#score
def display_score():
   current_time = int(pygame.time.get_ticks() / 1000) - start_time
   score = font.render(f'Score : {current_time}', False, 'palevioletred4')
   score_rect = score.get_rect(center = (400, 50))
   display.blit(score, score_rect)
   return current_time

#general setup
pygame.init()

display = pygame.display.set_mode((800, 700))
pygame.display.set_caption('Strawberry Patch')

#clock
clock = pygame.time.Clock()

#score
font = pygame.font.Font('font/Pixelfont.ttf', 50)
#score = font.render('Score: ', False, (64,64,64))
#score_rect = score.get_rect(bottomright=(400, 50))

#game variables
game_active = False
start_time = 0
start_score = 0

#import images
bg = pygame.image.load('Images/Background.jpeg').convert_alpha()
ground = pygame.image.load('Images/ground.png').convert_alpha()
player = pygame.image.load('Images/Player.png').convert_alpha()
strawberry = pygame.image.load('Images/Strawberry.png').convert_alpha()

#create a rectangle around the ground
ground_rects = [
    ground.get_rect(topleft=(30, 600)),
    ground.get_rect(topleft=(290, 520)),
    ground.get_rect(topleft=(550, 600)),
    ground.get_rect(topleft=(30, 200)),
    ground.get_rect(topleft=(290, 300)),
    ground.get_rect(topleft=(550, 100))
]

#size of strawberry
strawberry = pygame.transform.scale(strawberry, (35, 35))
#create a rectangle around the strawberries
strawberry_rects = [
    strawberry.get_rect(topleft=(345, 480)),
    strawberry.get_rect(topleft=(400, 480)),
    strawberry.get_rect(topleft=(635, 560)),
    strawberry.get_rect(topleft=(635, 440)),
    strawberry.get_rect(topleft=(635, 320)),
    strawberry.get_rect(topleft=(110, 160)),
    strawberry.get_rect(topleft=(110, 50)),
    strawberry.get_rect(topleft=(240, 160)),
    strawberry.get_rect(topleft=(370, 160)),
    strawberry.get_rect(topleft=(600, 60))
]

#size of player
player = pygame.transform.scale(player, (50, 60))
#create a rectangle around the player
player_rect = player.get_rect(midbottom=(50, 560))
#homescreen player
player_homescreen = pygame.transform.scale(player, (100, 120))
player_homescreen_rect = player_homescreen.get_rect(midbottom=(400, 560))

game_name = font.render('Strawberry Patch', False, 'palevioletred4')
game_name_rect = game_name.get_rect(center=(400, 80))

game_message = font.render('Press space to run', False, 'palevioletred4')
game_message_rect = game_message.get_rect(center=(400, 650))

#set player gravity
player_gravity = 0

while True:
   #event loop
   for event in pygame.event.get():
      #closing the game
      if event.type == pygame.QUIT:
         pygame.quit()
         exit()
      if game_active:
         #keyboard input
         #if event.type == pygame.KEYDOWN:
         #player can only jump if on ground
         if event.type == pygame.KEYDOWN:
            if (event.key == pygame.K_SPACE and any(player_rect.bottom >= ground.top
                                                 for ground in ground_rects)):
               player_gravity = -20
      else:
         if event.type == pygame.KEYDOWN and event.key == pygame.K_SPACE:
            game_active = True
            player_rect.midbottom = (50, 560)
            start_time = int(pygame.time.get_ticks() / 1000)
            
      
      if game_active:
         #Display
         #update surface color
         display.fill('pink')
         #draw the background
         display.blit(bg, (0, 0))
   
         #ground platform positions
         display.blit(ground, (30, 600))  #starting platform (1)
         display.blit(ground, (290, 520))  # 2
         display.blit(ground, (550, 600))  #moving platform up down (3)
         display.blit(ground, (30, 200))  #moving platform left right (4)
         display.blit(ground, (290, 300))  # 5
         display.blit(ground, (550, 100))  #door platform (6)
   
         #strawberry positions
         for rect in strawberry_rects:
            display.blit(strawberry, rect)
   
         #increase gravity
         player_gravity += 1
         player_rect.y += player_gravity
         #if player falls off screen
         if player_rect.top <= 700:
            #player_rect.bottom = 560
            game_active = False
         #player collision with ground
         if player_rect.bottom >= ground.top for ground in ground_rects:
            player_rect.bottom = ground.top for ground in ground_rects
         #display images
         display.blit(player, (player_rect))
         
         #display score
         #pygame.draw.rect(display, 'pink', score_rect)
         #pygame.draw.rect(display, 'green', score_rect, 10)
         #display.blit(score, score_rect)
         start_score = display_score()
         
         #player keyboard input
         #keys = pygame.key.get_pressed()
         #if keys[pygame.K_SPACE]:
         #player_gravity = -20
   
         for strawberry in strawberry_rects:
            if player_rect.colliderect(strawberry):
               print("Player collected a strawberry!")
      else:
         #Homescreen, if game is not active
         display.fill('pink')
         display.blit(player_homescreen, player_homescreen_rect)

         #display score
         score_message = font.render(f'Your score: {start_score}', 
                                     False, 'palevioletred4')
         score_message_rect = score_message.get_rect(center=(400, 650))
         display.blit(game_name, game_name_rect)

         #display game message
         if start_score == 0:
            display.blit(game_message, game_message_rect)
         else:
            display.blit(score_message, score_message_rect)

      pygame.display.update()
      clock.tick(60)
